---
import BaseLayout from "@layouts/BaseLayout.astro";
import { getEntry } from "astro:content";
import { resolveSection } from "@lib/sectionRenderer";

const page = await getEntry("pages", "home");

if (!page) {
  throw new Error('Contenu "home" introuvable dans la collection pages.');
}
const sectionEntries = await Promise.all(
  page.data.sections.map(async ({ slug }) => {
    const entry = await getEntry("sections", slug);

    if (!entry) {
      console.warn(`Section manquante: sections/${slug}`);
    }

    return entry;
  })
);

const resolvedSections = await Promise.all(
  sectionEntries
    .filter((entry): entry is NonNullable<typeof entry> => Boolean(entry))
    .map(resolveSection)
);
---

<BaseLayout title={page.data.title} description={page.data.description}>
  {resolvedSections.map(({ Component, props }) => <Component {...props} />)}
</BaseLayout>
